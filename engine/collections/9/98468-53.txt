In 1777 , the Spanish Empire and Portuguese Empire signed the Treaty of San Ildefonso in which Portugal give the islands of Annobón and Fernando Poo in waters of the Gulf of Guinea , as well as the Guinean coast between the Niger River and the Ogooué River , to Spain .