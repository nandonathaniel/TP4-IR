Second - generation firewalls perform the work of their first - generation predecessors but operate up to layer 4 ( transport layer ) of the OSI model . This is achieved by retaining packets until enough information is available to make a judgement about its state . Known as stateful packet inspection , it records all connections passing through it and determines whether a packet is the start of a new connection , a part of an existing connection , or not part of any connection . Though static rules are still used , these rules can now contain connection state as one of their test criteria .